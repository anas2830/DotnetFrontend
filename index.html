<html>
<head>
    <title>Online Exam System</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        .bg-light {
            background-color: #f8f9fa !important;
        }
        .card {
            border: none !important;
            box-shadow: 0 0 10px 0 rgba(0, 0, 0, 0.1);
        }
        .card-header {
            background-color: #007bff !important;
            color: #fff !important;
        }
        .signup-link {
            font-size: 14px;
        }
    </style>
</head>

<body class="bg-light">

	<div class="container mt-5">
		<div class="row justify-content-center">
			<div class="col-md-4">
				<div class="card shadow">
					<div class="card-header text-center">
						User Login
					</div>

					<div class="card-body">
						<input type="email" id="email" class="form-control mb-3" placeholder="Email">
						<input type="password" id="password" class="form-control mb-3" placeholder="Password">

						<button class="btn btn-primary w-100 mb-3" onclick="userLogin(event)">
							Login
						</button>

						<!-- Signup Link -->
						<div class="text-center signup-link">
							Don't have an account?
							<a href="register.html" class="text-primary fw-semibold">
								Sign Up
							</a>
						</div>
					</div>

				</div>
			</div>
		</div>
	</div>

	<!--toast message-->
	<div class="toast-container position-fixed top-0 end-0 p-3">
        <div id="appToast" class="toast align-items-center text-white border-0" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="d-flex">
                <div class="toast-body" id="toastMessage"></div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
            </div>
        </div>
    </div>

	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
	<script src="/common/app.js"></script>

	<script>
		async function userLogin(event) {
			event.preventDefault();
	
			const email = document.getElementById('email').value.trim();
			const password = document.getElementById('password').value.trim();
	
			try {
				const response = await fetch("http://localhost:5223/api/auth/login", {
					method: "POST",
					headers: {
						"Content-Type": "application/json"
					},
					body: JSON.stringify({ email, password })
				});
	
				if (!response.ok) {
					const errData = await response.json();
					showToast(errData.message || "Login failed", "error");
					return;
				}
	
				const data = await response.json();
				showToast(data.message || "Login successful", "success");
				localStorage.setItem("token", data.token);
				localStorage.setItem("user", JSON.stringify({
					userId: data.userId,
					userName: data.userName,
					userRole: data.userRole
				}));

				if(data.userRole == "Admin") {
					window.location.href = "admin/dashboard.html";
				} else {
					window.location.href = "user/dashboard.html";
				}
			} catch (error) {
				console.error(error);
				showToast("Login failed. Please check your credentials.", "error");
			}
		}
	</script>
</body>
</html>
